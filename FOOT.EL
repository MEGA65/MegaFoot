' вAY OF THE иMPLODING фOOT' -------------------------' а COLLABORATIVE TEAM-EFFORT GAME MADE BY THE мега65 COMMUNITY'' гURCE:' -----' - иNITIAL BACKGROUND ART' - еLEVEN CODE INFRASTRUCTURE' - иNITIAL гAME MECHANICS' дEFT:' ----' - аRTISTIC PLAYER HEAD PERMUTATIONS#OUTPUT "FOOT"' банк4 мEMORY USAGE' ------------------' 4.0000 дма-лист' 4.0100 сунсет палеттес (EACH PALETTE IS 16*3 IN SIZE, HAVE 12 PALETTES)' 4.0800 сцреен меморы' 4.2000 петсции грапхицс' банк5 мEMORY USAGE' ------------------' 5.0000 SCREEN BUFFER' 5.1000 COLOR RAM BUFFER' 5.2000 DOUBLED-UP LAYER BUFFER' UNCOMMENT THIS LINE TO ADD DEBUG OUTPUT#DECLARE дебуг = 1.PETSCII VARS'------------#DEFINE форм╞лаыер = 0#DEFINE форм╞хуман = 1#DEFINE форм╞дуцк = 2#DEFINE форм╞маь = 3#DECLARE DATA╞ADDR = $42000#DECLARE MAX╞FRAMES(форм╞маь)#DECLARE FRAME╞ADDR(форм╞маь, 25)#DECLARE FRAME╞DBLUP╞ADDR(64)#DECLARE JDIR╞RAW, JFIRE, JDIR#DECLARE FRM╞IDX = 0#DECLARE FRMW, FRMH,FRMX,FRMY,FRMX1,FRMY1,FRAMEIDX,CDATA╞ADDR#DECLARE YY, SCRADDR,CLRADDR#DECLARE A$, LIDX, K, X, Y#DECLARE SRC╞ADDR, DEST╞ADDR, LENGTH, TRANSP#DECLARE DEST╞MB╞SEL, DEST╞BANK#DECLARE FORM, SZ#DEFINE плаыер = 0#DEFINE баддие = 1#DECLARE CHARACTER#DECLARE OPPONENT╞DATA╞ADDR#DECLARE DBLUP╞ADDR = $52000#DECLARE KNEEL╞FLAG = 0#DECLARE MIRROR, PLAYER╞MIRROR, BADDIE╞MIRROR, OPPONENT╞MIRROR, TMP╞MIRROR#DECLARE PX, PY ' PLAYER X,Y#DECLARE BX, BY ' BADDIE X,Y#DECLARE PLAYER╞ENERGY = 18#DECLARE LAG╞PENERGY = 0#DECLARE BADDIE╞ENERGY = 18#DECLARE LAG╞BENERGY = 0#DECLARE X1,Y1,X2,Y2, DRAW╞COLOR, IDX, TMPX1#DECLARE P╞X1, P╞Y1, P╞X2, P╞Y2#DECLARE O╞X1, O╞Y1, O╞X2, O╞Y2#DECLARE RET%#DEFINE цхар╞боь╞тл = 112#DEFINE цхар╞боь╞тр = 110#DEFINE цхар╞боь╞бл = 109#DEFINE цхар╞боь╞бр = 125#DEFINE цхар╞хорз   = 64#DEFINE цхар╞жерт   = 93#DEFINE цхар╞спаце  = 32.IMGS'----#DEFINE имг╞цлоудс = 0#DEFINE имг╞скы = 1#DEFINE имг╞лт╞моунт = 2#DEFINE имг╞дк╞моунт = 3#DEFINE имг╞ватер = 4#DEFINE имг╞хи╞гроунд = 5#DEFINE имг╞ло╞гроунд = 6#DEFINE имг╞сун = 7#DEFINE имг╞пвалк1 = 0#DEFINE имг╞пвалк2 = 1#DEFINE имг╞пвалк3 = 2#DEFINE имг╞ппунцх1 = 3#DEFINE имг╞ппунцх2 = 4#DEFINE имг╞ппунцх3 = 5#DEFINE имг╞пкицк1 = 6#DEFINE имг╞пкицк2 = 7#DEFINE имг╞пкицк3 = 8#DEFINE имг╞пкнеел1 = 9#DEFINE имг╞пкнеел2 = 10#DEFINE имг╞пкнеел3 = 11#DEFINE имг╞пкпунцх1 = 12#DEFINE имг╞пкпунцх2 = 13#DEFINE имг╞пкпунцх3 = 14#DEFINE имг╞пккицк1 = 15#DEFINE имг╞пккицк2 = 16#DEFINE имг╞пккицк3 = 17#DEFINE имг╞пдие1 = 18#DEFINE имг╞пдие2 = 19#DEFINE имг╞пдие3 = 20#DEFINE имг╞пдие4 = 21#DEFINE имг╞пдие5 = 22#DEFINE имг╞двалк1 = 0#DEFINE имг╞двалк2 = 1#DEFINE имг╞двалк3 = 2#DEFINE имг╞дяуацк1 = 3#DEFINE имг╞дяуацк2 = 4#DEFINE имг╞дяуацк3 = 5#DEFINE имг╞ддие1 = 6#DEFINE имг╞ддие2 = 7#DEFINE имг╞ддие3 = 8#DEFINE имг╞ддие4 = 9#DEFINE имг╞ддие5 = 10#DEFINE хигхест╞лаыер = 7#DECLARE FX, FY#DECLARE XOFFS(хигхест╞лаыер) ' OFFSET INTO CYCLING OF GRAPHIC#DECLARE DRAW╞ORDER(хигхест╞лаыер)DRAW╞ORDER(0) = имг╞скыDRAW╞ORDER(1) = имг╞сунDRAW╞ORDER(2) = имг╞цлоудсDRAW╞ORDER(3) = имг╞лт╞моунтDRAW╞ORDER(4) = имг╞дк╞моунтDRAW╞ORDER(5) = имг╞ватерDRAW╞ORDER(6) = имг╞хи╞гроундDRAW╞ORDER(7) = имг╞ло╞гроунд#DECLARE OFFS╞AMOUNT(хигхест╞лаыер)OFFS╞AMOUNT(0) = .7OFFS╞AMOUNT(1) = 0OFFS╞AMOUNT(2) = .1OFFS╞AMOUNT(3) = .5OFFS╞AMOUNT(4) = 1OFFS╞AMOUNT(5) = 1.5OFFS╞AMOUNT(6) = 2#DECLARE PALIDX, PTR.ANIMS'-----#DEFINE аним╞пвалк = 0#DEFINE аним╞ппунцх = 1#DEFINE аним╞пкицк = 2#DEFINE аним╞пкнеел╞дн = 3#DEFINE аним╞пкнеел╞уп = 4#DEFINE аним╞пкпунцх = 5#DEFINE аним╞пккицк = 6#DEFINE аним╞пдие = 7#DEFINE аним╞двалк = 0#DEFINE аним╞дяуацк = 1#DEFINE аним╞ддие = 2#DEFINE аним╞маь = 10#DECLARE ANIM╞ORDER(форм╞маь, аним╞маь, 10)ANIM╞ORDER(форм╞хуман, аним╞пвалк, 0) = имг╞пвалк1ANIM╞ORDER(форм╞хуман, аним╞пвалк, 1) = имг╞пвалк2ANIM╞ORDER(форм╞хуман, аним╞пвалк, 2) = имг╞пвалк3ANIM╞ORDER(форм╞хуман, аним╞пвалк, 3) = имг╞пвалк2ANIM╞ORDER(форм╞хуман, аним╞ппунцх, 0) = имг╞ппунцх1ANIM╞ORDER(форм╞хуман, аним╞ппунцх, 1) = имг╞ппунцх2ANIM╞ORDER(форм╞хуман, аним╞ппунцх, 2) = имг╞ппунцх3ANIM╞ORDER(форм╞хуман, аним╞ппунцх, 3) = имг╞ппунцх2ANIM╞ORDER(форм╞хуман, аним╞ппунцх, 4) = имг╞ппунцх1ANIM╞ORDER(форм╞хуман, аним╞пкицк, 0) = имг╞пкицк1ANIM╞ORDER(форм╞хуман, аним╞пкицк, 1) = имг╞пкицк2ANIM╞ORDER(форм╞хуман, аним╞пкицк, 2) = имг╞пкицк3ANIM╞ORDER(форм╞хуман, аним╞пкицк, 3) = имг╞пкицк2ANIM╞ORDER(форм╞хуман, аним╞пкицк, 4) = имг╞пкицк1ANIM╞ORDER(форм╞хуман, аним╞пкнеел╞дн, 0) = имг╞пкнеел1ANIM╞ORDER(форм╞хуман, аним╞пкнеел╞дн, 1) = имг╞пкнеел2ANIM╞ORDER(форм╞хуман, аним╞пкнеел╞дн, 2) = имг╞пкнеел3ANIM╞ORDER(форм╞хуман, аним╞пкнеел╞уп, 0) = имг╞пкнеел2ANIM╞ORDER(форм╞хуман, аним╞пкнеел╞уп, 1) = имг╞пкнеел1ANIM╞ORDER(форм╞хуман, аним╞пкпунцх, 0) = имг╞пкпунцх1ANIM╞ORDER(форм╞хуман, аним╞пкпунцх, 1) = имг╞пкпунцх2ANIM╞ORDER(форм╞хуман, аним╞пкпунцх, 2) = имг╞пкпунцх3ANIM╞ORDER(форм╞хуман, аним╞пкпунцх, 3) = имг╞пкпунцх2ANIM╞ORDER(форм╞хуман, аним╞пкпунцх, 4) = имг╞пкпунцх1ANIM╞ORDER(форм╞хуман, аним╞пккицк, 0) = имг╞пккицк1ANIM╞ORDER(форм╞хуман, аним╞пккицк, 1) = имг╞пккицк2ANIM╞ORDER(форм╞хуман, аним╞пккицк, 2) = имг╞пккицк3ANIM╞ORDER(форм╞хуман, аним╞пккицк, 3) = имг╞пккицк2ANIM╞ORDER(форм╞хуман, аним╞пккицк, 4) = имг╞пккицк1ANIM╞ORDER(форм╞хуман, аним╞пдие, 0) = имг╞пдие1ANIM╞ORDER(форм╞хуман, аним╞пдие, 1) = имг╞пдие2ANIM╞ORDER(форм╞хуман, аним╞пдие, 2) = имг╞пдие3ANIM╞ORDER(форм╞хуман, аним╞пдие, 3) = имг╞пдие4ANIM╞ORDER(форм╞хуман, аним╞пдие, 4) = имг╞пдие5ANIM╞ORDER(форм╞хуман, аним╞пдие, 5) = имг╞пдие5ANIM╞ORDER(форм╞хуман, аним╞пдие, 6) = имг╞пдие5ANIM╞ORDER(форм╞хуман, аним╞пдие, 7) = имг╞пдие5ANIM╞ORDER(форм╞хуман, аним╞пдие, 8) = имг╞пдие5ANIM╞ORDER(форм╞дуцк, аним╞двалк, 0) = имг╞двалк1ANIM╞ORDER(форм╞дуцк, аним╞двалк, 1) = имг╞двалк2ANIM╞ORDER(форм╞дуцк, аним╞двалк, 2) = имг╞двалк3ANIM╞ORDER(форм╞дуцк, аним╞двалк, 3) = имг╞двалк2ANIM╞ORDER(форм╞дуцк, аним╞дяуацк, 0) = имг╞дяуацк1ANIM╞ORDER(форм╞дуцк, аним╞дяуацк, 1) = имг╞дяуацк2ANIM╞ORDER(форм╞дуцк, аним╞дяуацк, 2) = имг╞дяуацк3ANIM╞ORDER(форм╞дуцк, аним╞дяуацк, 3) = имг╞дяуацк2ANIM╞ORDER(форм╞дуцк, аним╞дяуацк, 4) = имг╞дяуацк1ANIM╞ORDER(форм╞дуцк, аним╞ддие, 0) = имг╞ддие1ANIM╞ORDER(форм╞дуцк, аним╞ддие, 1) = имг╞ддие2ANIM╞ORDER(форм╞дуцк, аним╞ддие, 2) = имг╞ддие3ANIM╞ORDER(форм╞дуцк, аним╞ддие, 3) = имг╞ддие4ANIM╞ORDER(форм╞дуцк, аним╞ддие, 4) = имг╞ддие5ANIM╞ORDER(форм╞дуцк, аним╞ддие, 5) = имг╞ддие5ANIM╞ORDER(форм╞дуцк, аним╞ддие, 6) = имг╞ддие5ANIM╞ORDER(форм╞дуцк, аним╞ддие, 7) = имг╞ддие5ANIM╞ORDER(форм╞дуцк, аним╞ддие, 8) = имг╞ддие5#DECLARE MAX╞FRAME(форм╞маь, аним╞маь)MAX╞FRAME(форм╞хуман, аним╞пвалк) = 4MAX╞FRAME(форм╞хуман, аним╞ппунцх) = 5MAX╞FRAME(форм╞хуман, аним╞пкицк) = 5MAX╞FRAME(форм╞хуман, аним╞пкнеел╞дн) = 3MAX╞FRAME(форм╞хуман, аним╞пкнеел╞уп) = 2MAX╞FRAME(форм╞хуман, аним╞пкпунцх) = 5MAX╞FRAME(форм╞хуман, аним╞пккицк) = 5MAX╞FRAME(форм╞хуман, аним╞пдие) = 9MAX╞FRAME(форм╞дуцк, аним╞двалк) = 4MAX╞FRAME(форм╞дуцк, аним╞дяуацк) = 5MAX╞FRAME(форм╞дуцк, аним╞ддие) = 9.FANIM#DECLARE PLAYER╞FORM = 1 ' хуман#DECLARE BADDIE╞FORM = 1#DEFINE фаним╞валк = 0#DEFINE фаним╞пунцх = 1#DEFINE фаним╞кицк = 2#DEFINE фаним╞кнеел╞дн = 3#DEFINE фаним╞кнеел╞уп = 4#DEFINE фаним╞кпунцх = 5#DEFINE фаним╞ккицк = 6#DEFINE фаним╞дие = 7#DEFINE фаним╞маь = 8#DECLARE FORM╞ANIM(форм╞маь, фаним╞маь)FORM╞ANIM(форм╞хуман, фаним╞валк) = аним╞пвалкFORM╞ANIM(форм╞хуман, фаним╞пунцх) = аним╞ппунцхFORM╞ANIM(форм╞хуман, фаним╞кицк) = аним╞пкицкFORM╞ANIM(форм╞хуман, фаним╞кнеел╞дн) = аним╞пкнеел╞днFORM╞ANIM(форм╞хуман, фаним╞кнеел╞уп) = аним╞пкнеел╞упFORM╞ANIM(форм╞хуман, фаним╞кпунцх) = аним╞пкпунцхFORM╞ANIM(форм╞хуман, фаним╞ккицк) = аним╞пккицкFORM╞ANIM(форм╞хуман, фаним╞дие) = аним╞пдиеFORM╞ANIM(форм╞дуцк, фаним╞валк) = аним╞двалкFORM╞ANIM(форм╞дуцк, фаним╞пунцх) = аним╞дяуацкFORM╞ANIM(форм╞дуцк, фаним╞дие) = аним╞ддие#DECLARE PLAYER╞FRAME = 0#DECLARE PLAYER╞ANIM = 0 ' аним╞пвалк#DECLARE BADDIE╞FRAME = 0#DECLARE BADDIE╞ANIM = 0 ' аним╞пвалк.OFFSETS#DEFINE оффсет╞дата╞сизе  = 0#DEFINE оффсет╞нум╞фрамес = 2#DEFINE оффсет╞фраме0     = 3#DEFINE фрм╞оффсет╞ь          = 0#DEFINE фрм╞оффсет╞ы          = 1#DEFINE фрм╞оффсет╞в          = 2#DEFINE фрм╞оффсет╞х          = 3#DEFINE фрм╞оффсет╞хитбоьес   = 4#DEFINE фрм╞оффсет╞хб╞хеад    = 4#DEFINE фрм╞оффсет╞хб╞торсо   = 8#DEFINE фрм╞оффсет╞хб╞феет    = 12#DEFINE фрм╞оффсет╞хб╞аттацк  = 16#DEFINE фрм╞оффсет╞дата       = 20#DECLARE BX╞OFFS(3)BX╞OFFS(0) = фрм╞оффсет╞хб╞хеадBX╞OFFS(1) = фрм╞оффсет╞хб╞торсоBX╞OFFS(2) = фрм╞оффсет╞хб╞феетBX╞OFFS(3) = фрм╞оффсет╞хб╞аттацк'----.MAIN'----PRINT CHR$(27)+"5"PRINT CHR$(147);BORDER 0BACKGROUND 0GOSUB LOAD╞DATAPALIDX = 0GOSUB SET╞PALETTE.LOOP0  GOSUB INIT╞VARS  GOSUB SHOW╞TITLE  GOSUB GAMEPLAY  ' GOSUB GAMEOVER  GOTO LOOP0'---------------.TRANSPARENT╞DMA'---------------  WPOKE $40009, SRC╞ADDR  WPOKE $4000C, DEST╞ADDR  WPOKE $40007, LENGTH  POKE  $40004, TRANSP  POKE $D702, 4 ' DMA LIST IN BANK 4  POKE $D701, $00 ' DMA LIST MSB  POKE $D705, $00 ' DMA LIST LSB  RETURN'----------.SHOW╞TITLE'----------  PRINT CHR$(147);  PRINT CHR$(14);  ' LOWER-CASE  PRINT "вAY OF THE иMPLODING фOOT"  PRINT "========================="  PRINT "а GAME MADE BY THE мега65 COMMUNITY!"  GET KEY A$  A$=""  ' ALL REVERSE-CHAR SPACES FOR MOST OF SCREEN  EDMA 3, $F00, 160, $40800  PRINT CHR$(142);  ' UPPERCASE  RETURN#DECLARE DATA╞LOC(форм╞маь)'---------.LOAD╞DATA'---------  PTR = $42000    FORM = форм╞лаыер  BLOAD "LEVEL1-BG.DAT",P(PTR)  GOSUB INIT╞PETSCII╞FRAMES  GOSUB PREPARE╞DOUBLE╞COPY╞LAYER  GOSUB ╞INCREMENT╞PTR╞TO╞NEXT╞FREE  FORM = форм╞хуман  BLOAD "PLAYER.DAT",P(PTR)  GOSUB INIT╞PETSCII╞FRAMES  GOSUB ╞INCREMENT╞PTR╞TO╞NEXT╞FREE  FORM = форм╞дуцк  BLOAD "DUCK.DAT",P(PTR)  GOSUB INIT╞PETSCII╞FRAMES  GOSUB ╞INCREMENT╞PTR╞TO╞NEXT╞FREE  BLOAD "PAL.BIN",P($40100),R  RETURN'---------------------------.╞INCREMENT╞PTR╞TO╞NEXT╞FREE'---------------------------  SZ = WPEEK(PTR + оффсет╞дата╞сизе)  PTR = PTR + SZ  RETURN'-----------.SET╞PALETTE'----------- (PALIDX)  PTR = $40100 + PALIDX * 16 * 3  FOR K = 0 TO 15    ' RED    POKE $D100 + K + 16, PEEK(PTR)    PTR = PTR + 1    ' GREEN    POKE $D200 + K + 16, PEEK(PTR)    PTR = PTR + 1    ' BLUE    POKE $D300 + K + 16, PEEK(PTR)    PTR = PTR + 1  NEXT K  RETURN'---------.INIT╞VARS'---------  ' CLEAR DMA LIST AREA  FOR K = 0 TO 20    POKE $40000+K, 0  NEXT K  POKE $40000, $81 ' OPT = DEST ADDR мб SELECTOR  POKE $40001, $00 ' DEFAULT TO 1ST MEGABYTE  POKE $40002, $07 ' OPT = ENABLE TRANSPARENCY  POKE $40003, $86 ' OPT = SET TRANSPARENCY  POKE $40004, $20 ' TRANSPARENCY VALUE  POKE $40005, $00 ' END OF OPTIONS  POKE $40006, $00 ' цмд LSB = цопы  WPOKE $40007, $0000 ' LENGTH  WPOKE $40009, $1000 ' SOURCE ADDR  POKE $4000B, $05    ' SOURCE BANK  WPOKE $4000C, $1000 ' DEST ADDR  POKE $4000E, $05    ' DEST BANK  POKE $4000F, $00    ' цмд MSB (IGNORE)  WPOKE $40010, $0000 ' MODULO (IGNORE)  ' CLEAR THE OFFSCREEN BUFFER  EDMA 3, $F00, 160, $50000  EDMA 3, $A0, $20, $50F00  EDMA 3, $FA0, $4F, $51000  KNEEL╞FLAG = 0  PLAYER╞FORM = форм╞хуман  BADDIE╞FORM = форм╞хуман  PLAYER╞FRAME = 0  PLAYER╞ANIM = FORM╞ANIM(PLAYER╞FORM, фаним╞валк)  PX = 0 : PY = 23  BX = 60 : BY = 23  PLAYER╞ENERGY = 18  LAG╞PENERGY = 0  BADDIE╞ENERGY = 18  LAG╞BENERGY = 0  PLAYER╞MIRROR = 0  BADDIE╞MIRROR = 1  RETURN'-------------------.INIT╞PETSCII╞FRAMES'-------------------  MAX╞FRAMES(FORM) = PEEK(PTR + оффсет╞нум╞фрамес)  PTR = PTR + оффсет╞фраме0  FRM╞IDX = 0  DO WHILE FRM╞IDX < MAX╞FRAMES(FORM)    FRAME╞ADDR(FORM, FRM╞IDX) = PTR    FRMW = PEEK(PTR + фрм╞оффсет╞в)    FRMH = PEEK(PTR + фрм╞оффсет╞х)        'PRINT "PTR=";HEX$(PTR);", IDX=";FRM╞IDX;", W=";FRMW;", H=";FRMH    PTR = PTR + фрм╞оффсет╞дата + FRMW * FRMH    ':PRINT CHR$(147);"FRM╞IDX=";FRM╞IDX    FRM╞IDX = FRM╞IDX + 1  LOOP  RETURN'-------------------------.PREPARE╞DOUBLE╞COPY╞LAYER'-------------------------  DBLUP╞ADDR = $52000  FOR FRAMEIDX = 0 TO MAX╞FRAMES(форм╞лаыер)-1    PTR = FRAME╞ADDR(форм╞лаыер, FRAMEIDX)    FRMX = PEEK(PTR + фрм╞оффсет╞ь)    FRMY = PEEK(PTR + фрм╞оффсет╞ы)    FRMW = PEEK(PTR + фрм╞оффсет╞в)    FRMH = PEEK(PTR + фрм╞оффсет╞х)    FRMX1=FRMX+FRMW-1    FRMY1=FRMY+FRMH-1    FRAME╞DBLUP╞ADDR(FRAMEIDX) = DBLUP╞ADDR    ' цопы цолор FOR EACH ROW TWICE INTO SOME LOCATION IN DBLUP╞ADDR    FOR Y = FRMY TO FRMY1      FOR K = 0 TO 1          ' COPY IT TO SOME PLACE IN $5.2000          EDMA 0, FRMW, (PTR + фрм╞оффсет╞дата), DBLUP╞ADDR          DBLUP╞ADDR = DBLUP╞ADDR + FRMW      NEXT K      PTR = PTR + FRMW    NEXT Y  NEXT FRAMEIDX  RETURN'---------------.DRAW╞BACKGROUND'---------------   '   FRAMEIDX = имг╞сун   '   GOSUB DRAW╞PETSCII╞LAYER    '   RETURN  POKE $4000B, $05  ' ASSURE SOURCE BANK 5 (FOR DOUBLED-UP LAYERS)  FOR LIDX = 0 TO MAX╞FRAMES(форм╞лаыер)-1     ' IF LAYER╞VISIBLE[LIDX] = 1 THEN BEGIN       FRAMEIDX = DRAW╞ORDER(LIDX)       GOSUB DRAW╞PETSCII╞LAYER      'BEND  NEXT LIDX  RETURN'----------.MOVE╞RIGHT'----------  IF PX < 25 THEN BEGIN    PX = PX + 1  BEND:ELSE BEGIN    IF BX > 0 THEN BEGIN      GOSUB INCR╞OFFS      BX = BX - 1    BEND  BEND  KNEEL╞FLAG = 0  RETURN'---------.MOVE╞LEFT'---------  IF PX > 0 THEN BEGIN    PX = PX - 1  BEND:ELSE BEGIN    IF BX < 60 THEN BEGIN      GOSUB DECR╞OFFS      BX = BX + 1    BEND  BEND  KNEEL╞FLAG = 0  RETURN#DEFINE й╞уп = 1#DEFINE й╞уп╞ригхт = 2#DEFINE й╞ригхт = 3#DEFINE й╞довн╞ригхт = 4#DEFINE й╞довн = 5#DEFINE й╞довн╞лефт = 6#DEFINE й╞лефт = 7#DEFINE й╞уп╞лефт = 8#DEFINE й╞фире = 128'--------------.GET╞USER╞INPUT'--------------  ' KEYBOARD INPUT  ' --------------  GET A$  IF A$="," AND PALIDX>0 THEN PALIDX=PALIDX-1:GOSUB SET╞PALETTE  IF A$="." AND PALIDX<11 THEN PALIDX=PALIDX+1:GOSUB SET╞PALETTE  IF A$="1" THEN BEGIN    дебуг=MOD(дебуг+1,2)    EDMA 3, $F00, 160, $50000    EDMA 3, $F00, 160, $40800  BEND  ' D = TOGGLE BETWEEN HUMAN AND DUCK  IF A$="D" THEN BEGIN    IF PLAYER╞FORM = форм╞хуман THEN BEGIN      PLAYER╞FORM = форм╞дуцк    BEND:ELSE BEGIN      PLAYER╞FORM = форм╞хуман    BEND    PLAYER╞ANIM = FORM╞ANIM(PLAYER╞FORM, фаним╞валк)    PLAYER╞FRAME = 0    KNEEL╞FLAG = 0  BEND  IF A$="<" THEN PLAYER╞ENERGY = PLAYER╞ENERGY - 1  IF A$=">" THEN BADDIE╞ENERGY = BADDIE╞ENERGY - 1  ' JOYSTICK INPUT  ' --------------  JDIR╞RAW = JOY(2)  JFIRE = JDIR╞RAW AND 128  JDIR = JDIR╞RAW AND $7F  ' HANDLE NO INPUT CASES  ' ---------------------  IF JDIR╞RAW=0 AND PLAYER╞ANIM = аним╞пкнеел╞дн THEN BEGIN    IF PLAYER╞FRAME >= MAX╞FRAME(форм╞хуман, аним╞пкнеел╞дн)-1 THEN BEGIN    KNEEL╞FLAG = 0    PLAYER╞ANIM = аним╞пкнеел╞уп    PLAYER╞FRAME = 0    BEND  BEND  IF JDIR╞RAW = 0 THEN RETURN  ' HANDLE CASES WITH SOME INPUT  ' ----------------------------  IF JDIR=й╞ригхт THEN GOSUB MOVE╞RIGHT  IF JDIR=й╞лефт THEN GOSUB MOVE╞LEFT  IF JFIRE=128 AND JDIR=й╞уп╞ригхт AND PLAYER╞ANIM = FORM╞ANIM(PLAYER╞FORM, фаним╞валк) THEN BEGIN    PLAYER╞ANIM = FORM╞ANIM(PLAYER╞FORM, фаним╞пунцх)    IF KNEEL╞FLAG = 1 THEN PLAYER╞ANIM = аним╞пкпунцх    PLAYER╞FRAME = 0  BEND  IF JFIRE=128 AND JDIR=й╞довн╞ригхт AND PLAYER╞ANIM = аним╞пвалк THEN BEGIN    PLAYER╞ANIM = аним╞пкицк    IF KNEEL╞FLAG = 1 THEN PLAYER╞ANIM = аним╞пккицк    PLAYER╞FRAME = 0  BEND  IF A$="X" THEN BEGIN    KNEEL╞FLAG = 0    PLAYER╞ANIM = FORM╞ANIM(PLAYER╞FORM, фаним╞дие)    PLAYER╞FRAME = 0  BEND  IF JDIR=й╞довн AND PLAYER╞ANIM = аним╞пвалк THEN BEGIN    PLAYER╞ANIM = аним╞пкнеел╞дн    PLAYER╞FRAME = 0  BEND  RETURN'-----------.DRAW╞PLAYER'-----------  CHARACTER = плаыер  FRAMEIDX = ANIM╞ORDER(PLAYER╞FORM, PLAYER╞ANIM, PLAYER╞FRAME)  FX=PX : FY=PY  MIRROR = PLAYER╞MIRROR  FORM = PLAYER╞FORM  GOSUB DRAW╞PETSCII╞FRAME  RETURN'-----------.DRAW╞BADDIE'-----------  CHARACTER = баддие  FRAMEIDX = ANIM╞ORDER(BADDIE╞FORM, BADDIE╞ANIM, BADDIE╞FRAME)  FX=BX : FY=BY  MIRROR = BADDIE╞MIRROR  FORM = BADDIE╞FORM  GOSUB DRAW╞PETSCII╞FRAME  RETURN'--------------------------.CONSIDER╞NEXT╞PLAYER╞FRAME'--------------------------  IF PLAYER╞ANIM = FORM╞ANIM(PLAYER╞FORM, фаним╞валк) AND (JDIR=й╞лефт OR JDIR=й╞ригхт) THEN BEGIN    PLAYER╞FRAME = PLAYER╞FRAME + 1  BEND  IF PLAYER╞ANIM <> FORM╞ANIM(PLAYER╞FORM, фаним╞валк) THEN BEGIN    PLAYER╞FRAME = PLAYER╞FRAME + 1  BEND  IF PLAYER╞ANIM = аним╞пкнеел╞дн AND JDIR=й╞довн THEN BEGIN    IF PLAYER╞FRAME >= MAX╞FRAME(форм╞хуман, аним╞пкнеел╞дн) THEN BEGIN      PLAYER╞FRAME = MAX╞FRAME(форм╞хуман, аним╞пкнеел╞дн) - 1      KNEEL╞FLAG = 1    BEND    RETURN  BEND  IF PLAYER╞FRAME >= MAX╞FRAME(PLAYER╞FORM, PLAYER╞ANIM) THEN BEGIN    IF PLAYER╞ANIM = аним╞пдие THEN BEGIN      PLAYER╞ANIM = аним╞пкнеел╞уп      PLAYER╞FRAME = 0      RETURN    BEND    IF KNEEL╞FLAG = 1 AND PLAYER╞ANIM <> аним╞пкнеел╞дн THEN BEGIN      PLAYER╞ANIM = аним╞пкнеел╞дн      PLAYER╞FRAME = MAX╞FRAME(форм╞хуман, аним╞пкнеел╞дн) - 1    BEND:ELSE BEGIN      PLAYER╞ANIM = FORM╞ANIM(PLAYER╞FORM, фаним╞валк)      PLAYER╞FRAME = 0    BEND  BEND  RETURN'--------------------------.CONSIDER╞NEXT╞BADDIE╞FRAME'--------------------------  IF BADDIE╞ANIM <> аним╞пвалк THEN BEGIN    BADDIE╞FRAME = MOD(BADDIE╞FRAME + 1, MAX╞FRAME(BADDIE╞FORM, BADDIE╞ANIM))  BEND  GOSUB IF╞PLAYER╞FAR╞WALK╞CLOSER  GOSUB IF╞PLAYER╞NEARER╞WALK╞CAUTIOUS  GOSUB IF╞PLAYER╞HITTABLE╞TRY╞HITTING  ' IF PLAYER IS TRYING TO HIT ME, CONSIDER FLEEING  RETURN'------------------------------.IF╞PLAYER╞HITTABLE╞TRY╞HITTING'------------------------------  ' IF PLAYER IS WITHIN HITTING DISTANCE, CONSIDER HITTING  IF ABS(PX-BX) >= 8 AND BADDIE╞ANIM = аним╞пвалк THEN BEGIN    K = INT(RND(1)*8)    IF K = 1 THEN BADDIE╞ANIM = аним╞ппунцх:BADDIE╞FRAME=0    IF K = 2 THEN BADDIE╞ANIM = аним╞пкицк:BADDIE╞FRAME=0  BEND  RETURN'------------------------------.IF╞PLAYER╞NEARER╞WALK╞CAUTIOUS'------------------------------  ' IF PLAYER IS NEARER, WALK AHEAD MORE CAUTIOUSLY  IF ABS(PX-BX) > 8 THEN BEGIN    IF INT(RND(1)*4) >= 3 THEN GOSUB MOVE╞BADDIE╞CLOSER  BEND  RETURN'-------------------------.IF╞PLAYER╞FAR╞WALK╞CLOSER'-------------------------  ' IF PLAYER IS A LONG DISTANCE AWAY, COMMIT TO WALKING CLOSER  IF ABS(PX-BX) > 20 THEN BEGIN    GOSUB MOVE╞BADDIE╞CLOSER  BEND  RETURN'------------------.MOVE╞BADDIE╞CLOSER'------------------  BADDIE╞ANIM = аним╞пвалк  BADDIE╞FRAME = BADDIE╞FRAME + 1  IF BADDIE╞FRAME >= MAX╞FRAME(BADDIE╞FORM, BADDIE╞ANIM) THEN BADDIE╞FRAME = 0  IF BX > PX THEN BEGIN    BX = BX - 1  BEND:ELSE BEGIN    BX = BX + 1  BEND  RETURN'------------------.DRAW╞PETSCII╞FRAME'------------------  POKE $4000B, $04  ' ASSURE SOURCE BANK 4 (FOR ORIGINAL FRAME DATA)  IF MIRROR = 1 THEN SETBIT $40006, 5:ELSE CLRBIT $40006, 5  DATA╞ADDR = FRAME╞ADDR(FORM, FRAMEIDX)  FRMX = PEEK(DATA╞ADDR + фрм╞оффсет╞ь)  FRMY = PEEK(DATA╞ADDR + фрм╞оффсет╞ы)  FRMW = PEEK(DATA╞ADDR + фрм╞оффсет╞в)  FRMH = PEEK(DATA╞ADDR + фрм╞оффсет╞х)  FRMX = FX ' OVERRIDE POSITION  FRMY = FY  FRMX1=FRMX+FRMW-1  FRMY1=FRMY+FRMH-1  CLRADDR = $51000 + FRMX + FRMY * 80  IF MIRROR = 1 THEN CLRADDR = CLRADDR + FRMW - 1  CDATA╞ADDR = DATA╞ADDR + фрм╞оффсет╞дата  FOR YY=FRMY TO FRMY1    ' DRAW CHARS    ' ----------    SRC╞ADDR = CDATA╞ADDR    DEST╞ADDR = CLRADDR    LENGTH = FRMW    TRANSP = $FF    GOSUB TRANSPARENT╞DMA    CDATA╞ADDR = CDATA╞ADDR + FRMW    CLRADDR = CLRADDR + 80    NEXT YY  IF дебуг THEN GOSUB DRAW╞BOXES  RETURN'------------------.DRAW╞PETSCII╞LAYER'------------------  CLRBIT $40006, 5  DATA╞ADDR = FRAME╞ADDR(форм╞лаыер, FRAMEIDX)  FRMX = PEEK(DATA╞ADDR + фрм╞оффсет╞ь)  FRMY = PEEK(DATA╞ADDR + фрм╞оффсет╞ы)  FRMW = PEEK(DATA╞ADDR + фрм╞оффсет╞в)  FRMH = PEEK(DATA╞ADDR + фрм╞оффсет╞х)  FRMX1=FRMX+FRMW-1  FRMY1=FRMY+FRMH-1  CLRADDR = $51000 + FRMX + FRMY * 80  CDATA╞ADDR = DATA╞ADDR + фрм╞оффсет╞дата + FRMW * FRMH  XOFFS(FRAMEIDX) = MOD(XOFFS(FRAMEIDX) + 80, 80)  XOFFS = INT(XOFFS(FRAMEIDX))  CDATA╞ADDR = FRAME╞DBLUP╞ADDR(FRAMEIDX)  FOR YY=FRMY TO FRMY1    ' DRAW CHARS FROM OFFSET TO END    ' -----------------------------    SRC╞ADDR = CDATA╞ADDR + XOFFS    DEST╞ADDR = CLRADDR    LENGTH = FRMW    TRANSP = $FF    GOSUB TRANSPARENT╞DMA    CDATA╞ADDR = CDATA╞ADDR + FRMW * 2    CLRADDR = CLRADDR + 80    NEXT YY  RETURN'--------.GAMEPLAY'--------  GOSUB GET╞USER╞INPUT  GOSUB DRAW╞BACKGROUND  GOSUB DRAW╞SPRITES  GOSUB PAGE╞FLIP  GOSUB GAME╞LOGIC  GOSUB DRAW╞ENERGY╞BARS  GOTO GAMEPLAY  RETURN'----------------.DRAW╞ENERGY╞BARS'----------------  IF PLAYER╞ENERGY <> LAG╞PENERGY THEN BEGIN    IF LAG╞PENERGY < PLAYER╞ENERGY THEN BEGIN      LAG╞PENERGY = LAG╞PENERGY + 1      K = LAG╞PENERGY      GOSUB DRAW╞BLUE╞TRIANGLE      RETURN    BEND    IF LAG╞PENERGY > PLAYER╞ENERGY THEN BEGIN      K = LAG╞PENERGY      GOSUB CLEAR╞BLUE╞TRIANGLE      LAG╞PENERGY = LAG╞PENERGY - 1      RETURN    BEND  BEND  IF BADDIE╞ENERGY <> LAG╞BENERGY THEN BEGIN    IF LAG╞BENERGY < BADDIE╞ENERGY THEN BEGIN      LAG╞BENERGY = LAG╞BENERGY + 1      K = LAG╞BENERGY      GOSUB DRAW╞RED╞TRIANGLE      RETURN    BEND    IF LAG╞BENERGY > BADDIE╞ENERGY THEN BEGIN      K = LAG╞BENERGY      GOSUB CLEAR╞RED╞TRIANGLE      LAG╞BENERGY = LAG╞BENERGY - 1      RETURN    BEND  BEND  RETURN'------------------.DRAW╞BLUE╞TRIANGLE'------------------  CURSOR 1 + K * 2, 48:PRINT " ъ";  CURSOR 1 + K * 2, 49:PRINT "▓╘";  RETURN'-------------------.CLEAR╞BLUE╞TRIANGLE'-------------------  CURSOR 1 + K * 2, 48:PRINT "▓ ";  CURSOR 1 + K * 2, 49:PRINT "▓ ";  RETURN'-----------------.DRAW╞RED╞TRIANGLE'-----------------  CURSOR 78 - K * 2, 48:PRINT "√╘";  CURSOR 78 - K * 2, 49:PRINT "▓ъ";  RETURN'------------------.CLEAR╞RED╞TRIANGLE'------------------  CURSOR 78 - K * 2, 48:PRINT "▓ ";  CURSOR 78 - K * 2, 49:PRINT "▓ ";  RETURN'------------.DRAW╞SPRITES'------------  GOSUB DRAW╞BADDIE  GOSUB DRAW╞PLAYER  RETURN'----------.GAME╞LOGIC'----------  GOSUB CONSIDER╞NEXT╞PLAYER╞FRAME  GOSUB CONSIDER╞NEXT╞BADDIE╞FRAME  RETURN'---------.PAGE╞FLIP'---------  IF дебуг THEN BEGIN    EDMA 0, $F00, $50000, $40800    EDMA 3, $F00, 160, $50000  BEND  EDMA 0, $F00, $51000, $FF80000  ' FILL THE TOP PART  EDMA 3, $F00, $4F, $51000  RETURN'---------.INCR╞OFFS'---------  FOR K = 0 TO хигхест╞лаыер    XOFFS(K) = XOFFS(K) + OFFS╞AMOUNT(K)  NEXT K  RETURN'---------.DECR╞OFFS'---------  FOR K = 0 TO хигхест╞лаыер    XOFFS(K) = XOFFS(K) - OFFS╞AMOUNT(K)  NEXT K  RETURN'----------.DRAW╞BOXES'----------  PTR = DATA╞ADDR + фрм╞оффсет╞хитбоьес  FOR IDX = 0 TO 3    X1 = PEEK(PTR + 0)    Y1 = PEEK(PTR + 1)    X2 = PEEK(PTR + 2)    Y2 = PEEK(PTR + 3)    IF NOT (X1=0 AND Y1=0 AND X2=0 AND Y2=0) THEN BEGIN      GOSUB ADJUST╞COORDS      DRAW╞COLOR = 7      IF IDX = 3 THEN BEGIN        DRAW╞COLOR = 2        GOSUB DRAW╞BOX        GOSUB CHECK╞IF╞HIT╞OPPONENT      BEND:ELSE BEGIN        GOSUB DRAW╞BOX      BEND    BEND    PTR = PTR + 4  NEXT IDX  RETURN'--------.DRAW╞BOX'--------  ' DRAW CORNERS  ' ------------  X = X1 : Y = Y1 : K = цхар╞боь╞тл : GOSUB DRAW╞CHAR  X = X2 : Y = Y1 : K = цхар╞боь╞тр : GOSUB DRAW╞CHAR  X = X1 : Y = Y2 : K = цхар╞боь╞бл : GOSUB DRAW╞CHAR  X = X2 : Y = Y2 : K = цхар╞боь╞бр : GOSUB DRAW╞CHAR  ' DRAW HORIZONTALS  ' ----------------  FOR X = X1+1 TO X2-1    Y = Y1 : K = цхар╞хорз : GOSUB DRAW╞CHAR    Y = Y2 : K = цхар╞хорз : GOSUB DRAW╞CHAR  NEXT X  ' DRAW VERTICALS  ' --------------  FOR Y = Y1+1 TO Y2-1    X = X1 : K = цхар╞жерт : GOSUB DRAW╞CHAR    X = X2 : K = цхар╞жерт : GOSUB DRAW╞CHAR  NEXT Y  RETURN'---------.DRAW╞CHAR'---------  IF PEEK($50000 + X + Y * 80) <> цхар╞спаце THEN BEGIN    K = K + 128  BEND:ELSE BEGIN    POKE $51000 + X + Y * 80, 1  BEND  IF DRAW╞COLOR = 2 THEN POKE $51000 + X + Y * 80, DRAW╞COLOR  POKE $50000 + X + Y * 80, K  RETURN'---------------------.CHECK╞IF╞HIT╞OPPONENT'---------------------  TMP╞MIRROR = MIRROR  IF CHARACTER = плаыер THEN BEGIN    FRAMEIDX = ANIM╞ORDER(BADDIE╞FORM, BADDIE╞ANIM, BADDIE╞FRAME)    OPPONENT╞DATA╞ADDR = FRAME╞ADDR(BADDIE╞FORM, FRAMEIDX)    OPPONENT╞MIRROR = BADDIE╞MIRROR    FX=BX : FY=BY  BEND  IF CHARACTER = баддие THEN BEGIN    FRAMEIDX = ANIM╞ORDER(PLAYER╞FORM, PLAYER╞ANIM, PLAYER╞FRAME)    OPPONENT╞DATA╞ADDR = FRAME╞ADDR(PLAYER╞FORM, FRAMEIDX)    OPPONENT╞MIRROR = PLAYER╞MIRROR    FX=PX : FY=PY  BEND  X1 = PEEK(DATA╞ADDR + фрм╞оффсет╞хб╞аттацк + 0)  Y1 = PEEK(DATA╞ADDR + фрм╞оффсет╞хб╞аттацк + 1)  X2 = PEEK(DATA╞ADDR + фрм╞оффсет╞хб╞аттацк + 2)  Y2 = PEEK(DATA╞ADDR + фрм╞оффсет╞хб╞аттацк + 3)  GOSUB ADJUST╞COORDS  P╞X1 = X1  P╞Y1 = Y1  P╞X2 = X2  P╞Y2 = Y2  FRMX = PEEK(OPPONENT╞DATA╞ADDR + фрм╞оффсет╞ь)  FRMY = PEEK(OPPONENT╞DATA╞ADDR + фрм╞оффсет╞ы)  FRMX = FRMX + FX  FRMY = FRMY + FY  FRMW = PEEK(OPPONENT╞DATA╞ADDR + фрм╞оффсет╞в)  FRMH = PEEK(OPPONENT╞DATA╞ADDR + фрм╞оффсет╞х)  ' ITERATE THROUGH HEAD/TORSO/FEET HITBOXES OF OPPONENT  PTR = OPPONENT╞DATA╞ADDR + фрм╞оффсет╞хитбоьес  FOR IDX = 0 TO 2    X1 = PEEK(PTR + 0)    Y1 = PEEK(PTR + 1)    X2 = PEEK(PTR + 2)    Y2 = PEEK(PTR + 3)    GOSUB ADJUST╞COORDS    O╞X1 = X1    O╞Y1 = Y1    O╞X2 = X2    O╞Y2 = Y2    GOSUB CHECK╞BOX╞COLLISION    IF RET% = 1 THEN BEGIN      IF CHARACTER = баддие THEN BEGIN        PLAYER╞ANIM = FORM╞ANIM(PLAYER╞FORM, фаним╞дие)        PLAYER╞FRAME = 0        IF PLAYER╞ENERGY > 0 THEN PLAYER╞ENERGY = PLAYER╞ENERGY - 1      BEND      IF CHARACTER = плаыер THEN BEGIN        BADDIE╞ANIM = FORM╞ANIM(BADDIE╞FORM, фаним╞дие)        BADDIE╞FRAME = 0        IF BADDIE╞ENERGY > 0 THEN BADDIE╞ENERGY = BADDIE╞ENERGY - 1      BEND    BEND  NEXT IDX  MIRROR = TMP╞MIRROR  RETURN'-------------.ADJUST╞COORDS'-------------  IF MIRROR = 0 THEN BEGIN    X1 = FRMX + X1    Y1 = FRMY + Y1    X2 = FRMX + X2    Y2 = FRMY + Y2  BEND:ELSE BEGIN    TMPX1 = X1    X1 = FRMX + FRMW - X2 - 1    Y1 = FRMY + Y1    X2 = FRMX + FRMW - TMPX1 - 1    Y2 = FRMY + Y2  BEND  RETURN'-------------------.CHECK╞BOX╞COLLISION'-------------------  'PRINT "";CHR$(27);"Q";P╞X1;P╞Y1;P╞X2;P╞Y2  'PRINT CHR$(27);"Q";O╞X1;O╞Y1;O╞X2;O╞Y2;  'GET KEY A$  IF NOT ((O╞X1 > P╞X2) OR _          (O╞X2 < P╞X1) OR _          (O╞Y1 > P╞Y2) OR _          (O╞Y2 < P╞Y1)) THEN _  BEGIN    RET% = 1  BEND:ELSE BEGIN    RET% = 0  BEND  RETURN